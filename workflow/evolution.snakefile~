rule extra_species_THAP_analysis:
  output:
    placei='species/placei/protein_sequences/placei.protein.longest_isoform.fa',
    caninum='species/caninum/protein_sequences/caninum.protein.longest_isoform.fa',
    polygyrus='species/polygyrus/protein_sequences/polygyrus.protein.longest_isoform.fa',
    brasiliensis='species/brasiliensis/protein_sequences/brasiliensis.protein.longest_isoform.fa',
    viviparus='species/viviparus/protein_sequences/viviparus.protein.longest_isoform.fa',
    rhodensis='species/rhodensis/protein_sequences/rhodensis.protein.longest_isoform.fa',
    sinica='species/sinica/protein_sequences/sinica.protein.longest_isoform.fa',
    afra='species/afra/protein_sequences/afra.protein.longest_isoform.fa',
    panamensis='species/panamensis/protein_sequences/panamensis.protein.longest_isoform.fa',
    virilis='species/virilis/protein_sequences/virilis.protein.longest_isoform.fa',
  shell:
    '''
    wget ftp://ftp.ebi.ac.uk/pub/databases/wormbase/parasite/releases/WBPS15/species/haemonchus_placei/PRJEB509/haemonchus_placei.PRJEB509.WBPS15.protein.fa.gz -O {output.placei}.to_clean.gz; gunzip {output.placei}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.placei}.to_clean | fold -s -w60 > {output.placei}.clean; rm {output.placei}.to_clean; python scripts/other_species_protein_fix.py {output.placei}.clean {output.placei}; rm {output.placei}.clean
    wget ftp://ftp.ebi.ac.uk/pub/databases/wormbase/parasite/releases/WBPS15/species/ancylostoma_caninum/PRJNA72585/ancylostoma_caninum.PRJNA72585.WBPS15.protein.fa.gz -O {output.caninum}.to_clean.gz; gunzip {output.caninum}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.caninum}.to_clean | fold -s -w60 > {output.caninum}.clean; rm {output.caninum}.to_clean; python scripts/other_species_protein_fix.py {output.caninum}.clean {output.caninum}; rm {output.caninum}.clean
    wget ftp://ftp.ebi.ac.uk/pub/databases/wormbase/parasite/releases/WBPS15/species/heligmosomoides_polygyrus/PRJEB15396/heligmosomoides_polygyrus.PRJEB15396.WBPS15.protein.fa.gz -O {output.polygyrus}.to_clean.gz; gunzip {output.polygyrus}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.polygyrus}.to_clean | fold -s -w60 > {output.polygyrus}.clean; rm {output.polygyrus}.to_clean; python scripts/other_species_protein_fix.py {output.polygyrus}.clean {output.polygyrus}; rm {output.polygyrus}.clean
    wget ftp://ftp.ebi.ac.uk/pub/databases/wormbase/parasite/releases/WBPS15/species/nippostrongylus_brasiliensis/PRJEB511/nippostrongylus_brasiliensis.PRJEB511.WBPS15.protein.fa.gz -O {output.brasiliensis}.to_clean.gz; gunzip {output.brasiliensis}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.brasiliensis}.to_clean | fold -s -w60 > {output.brasiliensis}.clean; rm {output.brasiliensis}.to_clean; python scripts/other_species_protein_fix.py {output.brasiliensis}.clean {output.brasiliensis}; rm {output.brasiliensis}.clean
    wget ftp://ftp.ebi.ac.uk/pub/databases/wormbase/parasite/releases/WBPS15/species/dictyocaulus_viviparus/PRJNA72587/dictyocaulus_viviparus.PRJNA72587.WBPS15.protein.fa.gz -O {output.viviparus}.to_clean.gz; gunzip {output.viviparus}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.viviparus}.to_clean | fold -s -w60 > {output.viviparus}.clean; rm {output.viviparus}.to_clean; python scripts/other_species_protein_fix.py {output.viviparus}.clean {output.viviparus}; rm {output.viviparus}.clean
    wget https://figshare.com/ndownloader/files/24649328?private_link=7787e173bba6f44d0aa5 -O {output.rhodensis}.to_clean; fold -s -w60 {output.rhodensis}.to_clean > {output.rhodensis}.clean; rm {output.rhodensis}.to_clean; python scripts/other_species_protein_fix.py {output.rhodensis}.clean {output.rhodensis}; rm {output.rhodensis}.clean
    wget http://download.caenorhabditis.org/v1/sequence/Caenorhabditis_sinica_JU800_v1.proteins.fa.gz -O {output.sinica}.to_clean.gz; gunzip {output.sinica}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.sinica}.to_clean | fold -s -w60 > {output.sinica}.clean; rm {output.sinica}.to_clean; python scripts/other_species_protein_fix.py {output.sinica}.clean {output.sinica}; rm {output.sinica}.clean
    wget http://download.caenorhabditis.org/v1/sequence/Caenorhabditis_afra_JU1286_v1.proteins.fa.gz -O {output.afra}.to_clean.gz; gunzip {output.afra}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.afra}.to_clean | fold -s -w60 > {output.afra}.clean; rm {output.afra}.to_clean; python scripts/other_species_protein_fix.py {output.afra}.clean {output.afra}; rm {output.afra}.clean
    wget http://download.caenorhabditis.org/v1/sequence/Caenorhabditis_sp28_QG2080_v1.proteins.fa.gz -O {output.panamensis}.to_clean.gz; gunzip {output.panamensis}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.panamensis}.to_clean | fold -s -w60 > {output.panamensis}.clean; rm {output.panamensis}.to_clean; python scripts/other_species_protein_fix.py {output.panamensis}.clean {output.panamensis}; rm {output.panamensis}.clean
    wget http://download.caenorhabditis.org/v1/sequence/Caenorhabditis_virilis_JU1968_v1.proteins.fa.gz -O {output.virilis}.to_clean.gz; gunzip {output.virilis}.to_clean.gz; awk 'BEGIN{{FS=" ";}}{{if ($1 ~ ">") print $1; else print $0}}' {output.virilis}.to_clean | fold -s -w60 > {output.virilis}.clean; rm {output.virilis}.to_clean; python scripts/other_species_protein_fix.py {output.virilis}.clean {output.virilis}; rm {output.virilis}.clean
    '''
    

rule protein_blastdb:
  input:
    'species/{sample}/protein_sequences/{sample}.protein.longest_isoform.fa'
  output:
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.phr',
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.pin',
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.psq',
  shell:
    '''
    makeblastdb -in {input} -dbtype prot -out species/{wildcards.sample}/protein_sequences/blastdb/{wildcards.sample}.protein.longest_isoform.fa
    '''


rule him17_elegans:
  input:
    'species/elegans/protein_sequences/elegans.protein.longest_isoform.fa',
  output:
    'TF_evolution/HIM17.prot.fa',
  shell:
    '''
    samtools faidx {input[0]} WBGene00001874 > {output[0]}
    '''


rule him17_orthologs:
  input:
    'TF_evolution/HIM17.prot.fa',
    'species/{sample}/protein_sequences/{sample}.protein.longest_isoform.fa',
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.phr',
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.pin',
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.psq',
  output:
    'TF_evolution/orthologs/HIM17.{sample}.aln',
    'TF_evolution/orthologs/HIM17.{sample}.fa',
    temp('species/{sample}/protein_sequences/{sample}.protein.longest_isoform.fa.clean'),
    temp('species/{sample}/protein_sequences/{sample}.protein.longest_isoform.fa.clean.fai'),
  resources:
    cpus=8
  shell:
    '''
    short_species=$(echo {wildcards.sample} | cut -c1-3)
    blastp -query {input[0]} -db species/{wildcards.sample}/protein_sequences/blastdb/{wildcards.sample}.protein.longest_isoform.fa -outfmt 6 > {output[0]}
    touch {output[1]}
    if [ -s {output[0]} ]
    then
    evalue=$(head -n 1 {output[0]} | awk '{{print $11}}' | sed 's/e/*10^/g;s/ /*/')
    if (( $(echo "$evalue < 0.00001" |bc -l) ))
    then
    HIM17_ortho=$(head -n 1 {output[0]} | awk '{{print $2}}')
    echo -e ">"$short_species"_HIM17" > {output[1]}
    python scripts/fasta_seq_len_fix.py {input[1]} {output[2]}
    samtools faidx {output[2]} $HIM17_ortho | sed '1d' >> {output[1]}
    fi
    fi
    '''


rule him17_alignment:
  input:
    HIM17_all=expand('TF_evolution/orthologs/HIM17.{sample}.fa', sample=THAP_ANALYSIS_EURHABDITIS),
  output:
    'TF_evolution/orthologs/HIM17.all.fa',
    'TF_evolution/orthologs/HIM17.all.dist',
    'TF_evolution/orthologs/HIM17.all.aln',
  shell:
    '''
    cat {input.HIM17_all} >> {output[0]}
    clustalo --infile={output[0]} --distmat-out={output[1]}.temp --outfile={output[2]} --full-iter --full --percent-id --output-order=tree-order
    sed '1d' {output[1]}.temp > {output[1]}; rm {output[1]}.temp
    '''


rule hmmer_pristionchus:
  input:
    caenorhabditis_him17=expand('TF_evolution/orthologs/HIM17.{sample}.fa', sample=CAENORHABDITIS),
    pacificus_prot='species/pacificus/protein_sequences/pacificus.protein.longest_isoform.fa',
  output:
    'TF_evolution/orthologs/HIM17.caenorhabditis.fa',
    'TF_evolution/orthologs/HIM17.caenorhabditis.aln',
    'TF_evolution/orthologs/HIM17.caenorhabditis.hmm',
    'TF_evolution/orthologs/HIM17.caenorhabditis.pacificus.hits',
  shell:
    '''
    cat {input.caenorhabditis_him17} > {output[0]}
    clustalo --infile={output[0]} --outfile={output[1]} --full-iter --full --percent-id --output-order=tree-order
    hmmbuild {output[2]} {output[1]}
    hmmsearch --pfamtblout {output[3]} {output[2]} {input.pacificus_prot}
    '''


rule elegans_other_species_ortholog_id:
  input:
    'data/external_data/elegans.other_caenorhabditis.orthologs.id',
    'data/external_data/elegans.other_nematodes.orthologs.id',
  output:
    'data/external_data/elegans.inopinata.1to1.txt',
    'data/external_data/elegans.briggsae.1to1.txt',
    'data/external_data/elegans.nigoni.1to1.txt',
    'data/external_data/elegans.remanei.1to1.txt',
    'data/external_data/elegans.ceylanicum.1to1.txt',
    'data/external_data/elegans.contortus.1to1.txt',
    'data/external_data/elegans.bacteriophora.1to1.txt',
    'data/external_data/elegans.tipulae.1to1.txt',
  shell:
    '''
    python scripts/biomart_elegans_orthologs_parser.caenorhabditis.py {input[0]} {output[0]} {output[1]} {output[2]} {output[3]}
    python scripts/biomart_elegans_orthologs_parser.other_nematodes.py {input[1]} {output[4]} {output[5]} {output[6]} {output[7]}
    '''


rule briggsae_other_species_ortholog_id:
  input:
    'data/external_data/briggsae.other_caenorhabditis.orthologs.id'
  output:
    'data/external_data/briggsae.nigoni.1to1.txt',
    'data/external_data/briggsae.remanei.1to1.txt',
    'data/external_data/briggsae.elegans.1to1.txt',
    'data/external_data/briggsae.inopinata.1to1.txt',
  shell:
    '''
    python scripts/biomart_briggsae_orthologs_parser.caenorhabditis.py {input} {output[0]} {output[1]} {output[2]} {output[3]}
    '''


rule busco:
  input:
    'species/elegans/protein_sequences/elegans.protein.longest_isoform.fa',
  output:
    'busco_nematodes/run_nematoda_odb10/full_table.tsv',
    'absense_run/elegans.input.fa'
  conda:
    'env/busco.yaml'
  resources:
    cpus=8
  shell:
    '''
    busco -i {input[0]} -c {resources.cpus} -o busco_nematodes -m prot -l nematoda_odb10
    cat busco_nematodes/run_nematoda_odb10/busco_sequences/single_copy_busco_sequences/*.faa > {output[1]}
    '''

rule blastp_busco:
  input:
    'absense_run/elegans.input.fa',
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.phr',
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.pin',
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa.psq',
    'species/elegans/protein_sequences/blastdb/elegans.protein.longest_isoform.fa.phr',
    'species/elegans/protein_sequences/blastdb/elegans.protein.longest_isoform.fa.pin',
    'species/elegans/protein_sequences/blastdb/elegans.protein.longest_isoform.fa.psq',
    'species/{sample}/protein_sequences/{sample}.protein.longest_isoform.fa',
  output:
    'absense_run/first_pass_blastp/elegans.{sample}.out',
    'absense_run/second_pass_blastp/{sample}.elegans.out',
  resources:
    cpus=8
  params:
    'species/{sample}/protein_sequences/blastdb/{sample}.protein.longest_isoform.fa',
    'species/elegans/protein_sequences/blastdb/elegans.protein.longest_isoform.fa'
  shell:
    '''
    bash scripts/blastp_launcher.sh {params[0]} {input[0]} {output[0]} {params[1]} {input[7]} {output[1]} {resources.cpus}
    '''


rule blastp_parser:
  input:
    expand('absense_run/first_pass_blastp/elegans.{sample}.out', sample=ALL_SPECIES),
    expand('absense_run/second_pass_blastp/{sample}.elegans.out', sample=ALL_SPECIES)
  output:
    'absense_run/concatenated_orthologs.fa',
    'absense_run/concatenated_orthologs.phylip'
  shell:
    '''
    python scripts/blastp_parser.py absense_run/
    mkdir absense_run/orthologs
    python scripts/orthogroups_gen.py absense_run/ species/
    mkdir absense_run/orthologs_alignments
    cd absense_run/orthologs
    for file in orthogroup.*
    do
    muscle -in $file -out ../orthologs_alignments/$file.aln
    done
    cd ../../
    python scripts/orthologs_concat.py absense_run/ {output[0]} {output[1]}
    '''

rule protdist:
  input:
    'absense_run/concatenated_orthologs.phylip'
  output:
    'absense_run/concatenated_orthologs.dist'
  shell:
    '''
    echo -e "absense_run/concatenated_orthologs.phylip\nY" > absense_run/protdist.config
    protdist < absense_run/protdist.config
    python scripts/protdist_parser.py outfile absense_run/concatenated_orthologs.dist
    '''

rule absense_software_download:
  output:
    'abSENSE/Run_abSENSE.py'
  shell:
    '''
    git clone https://github.com/caraweisman/abSENSE.git
    '''

rule absense:
  input:
    'absense_run/concatenated_orthologs.dist',
    expand('TF_evolution/orthologs/HIM17.{sample}.aln', sample = ALL_SPECIES),
    'abSENSE/Run_abSENSE.py'
  output:
    'absense_run/HIM17.bitscore',
    'absense_run/HIM17.absense_analysis/Detection_failure_probabilities',
    'absense_run/HIM17.absense.pdf',
  shell:
    '''
    python scripts/TF_bitscore_extractor.py TF_evolution/orthologs HIM17 {output[0]} 0.0001
    python abSENSE/Run_abSENSE.py --distfile absense_run/concatenated_orthologs.dist --scorefile {output[0]} --out absense_run/HIM17.absense_analysis
    python abSENSE/Plot_abSENSE.py --distfile absense_run/concatenated_orthologs.dist --scorefile {output[0]} --gene HIM17 --outfile {output[2]}
    '''

rule THAP_profile_download:
  output:
    'data/external_data/THAP.hmm'
  shell:
    '''
    wget http://pfam.xfam.org/family/PF05485/hmm -O {output[0]}
    '''

rule THAP_alignment:
  input:
    'data/external_data/THAP.hmm',
    'species/{sample}/protein_sequences/{sample}.protein.longest_isoform.fa',
    'TF_evolution/orthologs/HIM17.{sample}.aln',
  output:
    'TF_evolution/THAP_conservation/{sample}.THAP.out',
    'TF_evolution/THAP_conservation/{sample}.THAP.parsed',
    temp('species/{sample}/protein_sequences/{sample}.protein.longest_isoform.fa.clean'),
    temp('species/{sample}/protein_sequences/{sample}.protein.longest_isoform.fa.clean.fai'),
  shell:
    '''
    hmmsearch --pfamtblout {output[0]} {input[0]} {input[1]}
    python scripts/hmmer_THAP_parser.py {output[0]} {output[1]}.temp {input[2]}
    python scripts/fasta_seq_len_fix.py {input[1]} {output[2]}
    if [ -s {output[1]}.temp ]
    then
    ortholog=$(head -n 1 {output[1]}.temp | cut -f 1)
    python scripts/fasta_seq_len_fix.py {input[1]} {output[2]}
    ortholog_len=$(samtools faidx {output[2]} $ortholog | bioawk -c fastx '{{ print length($seq) }}')
    awk -v var="$ortholog_len" '{{print $0 "\t" var}}' {output[1]}.temp > {output[1]}
    rm {output[1]}.temp
    else
    rm {output[1]}.temp
    touch {output[1]}
    touch {output[3]}
    fi
    '''


#rule THAP_domains_fasta:
#  input:
#    'TF_evolution/orthologs/HIM17.{sample}.fa',
#    'TF_evolution/THAP_conservation/{sample}.THAP.parsed',
#  output:
#    'TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_1.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_2.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_3.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_4.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_5.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_6.fa',
#  params:
#    'TF_evolution/THAP_conservation/THAP_domains'
#  shell:
#    '''
#    python scripts/THAP_domain_fa_extractor.py {input[0]} {input[1]} {params} {wildcards.sample}
#    domain_n=$(wc -l < {input[1]})
#    if [ $domain_n == 5 ]
#    then
#    mv {output[4]} {output[5]}
#    touch {output[4]}
#    fi
#    '''


#rule THAP_domains_fasta_all_species:
#  input:
#    THAP_1=expand('TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_1.fa', sample = THAP_ANALYSIS_SPECIES),
#    THAP_2=expand('TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_2.fa', sample = THAP_ANALYSIS_SPECIES),
#    THAP_3=expand('TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_3.fa', sample = THAP_ANALYSIS_SPECIES),
#    THAP_4=expand('TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_4.fa', sample = THAP_ANALYSIS_SPECIES),
#    THAP_5=expand('TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_5.fa', sample = THAP_ANALYSIS_SPECIES),
#    THAP_6=expand('TF_evolution/THAP_conservation/THAP_domains/{sample}_HIM17_THAP_6.fa', sample = THAP_ANALYSIS_SPECIES),
#  output:
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_1.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_2.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_3.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_4.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_5.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_6.fa',
#  shell:
#    '''
#    cat {input.THAP_1} > {output[0]}
#    cat	{input.THAP_2} > {output[1]}
#    cat	{input.THAP_3} > {output[2]}
#    cat	{input.THAP_4} > {output[3]}
#    cat	{input.THAP_5} > {output[4]}
#    cat	{input.THAP_6} > {output[5]}
#    '''


#rule THAP_domains_aln_all_species:
#  input:
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_1.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_2.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_3.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_4.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_5.fa',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_6.fa',
#  output:
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_1.aln',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_2.aln',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_3.aln',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_4.aln',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_5.aln',
#    'TF_evolution/THAP_conservation/THAP_domains/alignment/all_species_HIM17_THAP_6.aln',
#  shell:
#    '''
#    muscle -in {input[0]} -out {output[0]}
#    muscle -in {input[1]} -out {output[1]}
#    muscle -in {input[2]} -out {output[2]}
#    muscle -in {input[3]} -out {output[3]}
#    muscle -in {input[4]} -out {output[4]}
#    muscle -in {input[5]} -out {output[5]}
#    '''


rule DBD_profile_download:
  input:
    'data/external_data/DBD.list'
  output:
    'data/external_data/Pfam-A.hmm',
    'data/external_data/Pfam-A.DBD.hmm',
  shell:
    '''
    wget ftp://ftp.ebi.ac.uk/pub/databases/Pfam/releases/Pfam33.1/Pfam-A.hmm.gz -O {output[0]}.gz; gunzip {output[0]}.gz
    hmmfetch -o {output[1]} -f {output[0]} {input}
    '''


rule DBD_alignment:
  input:
    'data/external_data/Pfam-A.DBD.hmm',
    'TF_evolution/orthologs/HIM17.{sample}.fa'
  output:
    'TF_evolution/DBD_conservation/HIM17.{sample}.DBD.out',
    'TF_evolution/DBD_conservation/HIM17.{sample}.DBD.parsed',    
  shell:
    '''
    if [ -s "{input[1]}" ]
    then
    hmmsearch --domtblout {output[0]} {input[0]} {input[1]}
    python scripts/hmmer_DBD_parser.py {output[0]} {output[1]}
    else
    touch {output[0]}
    touch {output[1]}
    fi
    '''


rule orthologs_plots_R:
  input:
    'TF_evolution/orthologs/HIM17.all.dist',
    'data/external_data/elegans.inopinata.1to1.txt',
    'data/external_data/elegans.briggsae.1to1.txt',
    'data/external_data/elegans.nigoni.1to1.txt',
    'data/external_data/elegans.remanei.1to1.txt',
    'data/external_data/briggsae.nigoni.1to1.txt',
    'data/external_data/briggsae.remanei.1to1.txt',
    'data/external_data/briggsae.elegans.1to1.txt',
    'data/external_data/briggsae.inopinata.1to1.txt',
    expand('TF_evolution/THAP_conservation/{sample}.THAP.parsed', sample = THAP_ANALYSIS_SPECIES),
  output:
    'plots/HIM17_identity.heat.pdf',
    'plots/HIM17_orthologs_identity.pdf',
    'plots/THAP_domains_HIM17.pdf'
  shell:
    '''
    Rscript scripts/him17_orthologs.R
    '''
